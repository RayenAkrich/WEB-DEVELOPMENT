<div class="form-container">
  <h2>{{ isEditMode ? 'Modifier un livre' : 'Ajouter un livre' }}</h2>

  <form #bookForm="ngForm" (ngSubmit)="onSubmit(bookForm)" class="book-form">
    <!-- Titre -->
    <div class="form-group">
      <label for="title">Titre *</label>
      <input
        type="text"
        id="title"
        name="title"
        [(ngModel)]="model.title"
        #title="ngModel"
        required
        minlength="3"
        class="form-control"
        placeholder="Ex: Clean Code">
      
      <div class="error-message" *ngIf="title.invalid && title.dirty">
        <span *ngIf="title.errors?.['required']">Le titre est requis</span>
        <span *ngIf="title.errors?.['minlength']">Le titre doit contenir au moins 3 caractères</span>
      </div>
      <div class="error-message" *ngIf="title.valid && isTitleOnlyNumbers()">
        <span>Le titre ne peut pas être composé uniquement de chiffres</span>
      </div>
    </div>

    <!-- Auteur -->
    <div class="form-group">
      <label for="author">Auteur *</label>
      <input
        type="text"
        id="author"
        name="author"
        [(ngModel)]="model.author"
        #author="ngModel"
        required
        minlength="3"
        class="form-control"
        placeholder="Ex: Robert C. Martin">
      
      <div class="error-message" *ngIf="author.invalid && author.dirty">
        <span *ngIf="author.errors?.['required']">L'auteur est requis</span>
        <span *ngIf="author.errors?.['minlength']">L'auteur doit contenir au moins 3 caractères</span>
      </div>
    </div>

    <!-- Email éditeur -->
    <div class="form-group">
      <label for="publisherEmail">Email Éditeur *</label>
      <input
        type="email"
        id="publisherEmail"
        name="publisherEmail"
        [(ngModel)]="model.publisherEmail"
        #publisherEmail="ngModel"
        required
        email
        class="form-control"
        placeholder="Ex: contact@publisher.com">
      
      <div class="error-message" *ngIf="publisherEmail.invalid && publisherEmail.dirty">
        <span *ngIf="publisherEmail.errors?.['required']">L'email est requis</span>
        <span *ngIf="publisherEmail.errors?.['email']">Email invalide</span>
      </div>
    </div>

    <!-- Téléphone éditeur -->
    <div class="form-group">
      <label for="publisherPhone">Téléphone Éditeur (Tunisie)</label>
      <input
        type="text"
        id="publisherPhone"
        name="publisherPhone"
        [(ngModel)]="model.publisherPhone"
        #publisherPhone="ngModel"
        pattern="^[0-9]{8}$"
        class="form-control"
        placeholder="Ex: 12345678">
      
      <div class="error-message" *ngIf="publisherPhone.invalid && publisherPhone.dirty">
        <span *ngIf="publisherPhone.errors?.['pattern']">Le téléphone doit contenir exactement 8 chiffres</span>
      </div>
    </div>

    <!-- Date de publication -->
    <div class="form-group">
      <label for="releaseDate">Date de Publication *</label>
      <input
        type="date"
        id="releaseDate"
        name="releaseDate"
        [(ngModel)]="model.releaseDate"
        #releaseDate="ngModel"
        required
        min="1900-01-01"
        class="form-control">
      
      <div class="error-message" *ngIf="releaseDate.invalid && releaseDate.dirty">
        <span *ngIf="releaseDate.errors?.['required']">La date est requise</span>
      </div>
    </div>

    <!-- Catégorie -->
    <div class="form-group">
      <label for="category">Catégorie *</label>
      <select
        id="category"
        name="category"
        [(ngModel)]="model.category"
        #category="ngModel"
        required
        class="form-control">
        <option value="">-- Sélectionnez une catégorie --</option>
        <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
      </select>
      
      <div class="error-message" *ngIf="category.invalid && category.dirty">
        <span *ngIf="category.errors?.['required']">La catégorie est requise</span>
      </div>
    </div>

    <!-- Disponibilité -->
    <div class="form-group checkbox-group">
      <label>
        <input
          type="checkbox"
          name="isAvailable"
          [(ngModel)]="model.isAvailable"
          class="form-checkbox">
        Disponible
      </label>
    </div>

    <!-- Stock -->
    <div class="form-group">
      <label for="stock">Stock (facultatif)</label>
      <input
        type="number"
        id="stock"
        name="stock"
        [(ngModel)]="model.stock"
        #stock="ngModel"
        min="0"
        class="form-control"
        placeholder="Ex: 10">
      
      <div class="error-message" *ngIf="stock.invalid && stock.dirty">
        <span *ngIf="stock.errors?.['min']">Le stock ne peut pas être négatif</span>
      </div>
    </div>

    <!-- Boutons -->
    <div class="form-actions">
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="!bookForm.valid || isTitleOnlyNumbers()">
        {{ isEditMode ? 'Mettre à jour' : 'Ajouter' }}
      </button>

      <button
        type="button"
        class="btn btn-secondary"
        *ngIf="isEditMode"
        (click)="cancelEditing()">
        Annuler
      </button>

      <button
        type="button"
        class="btn btn-secondary"
        *ngIf="!isEditMode"
        (click)="resetForm()">
        Réinitialiser
      </button>
    </div>
  </form>
</div>
